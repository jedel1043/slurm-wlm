Description: FIX CVE-2017-15566
 Fix security issue caused by insecure SPANK environment variable
 handling, allowing privilege escalation to root during Prolog or Epilog
 execution
Author: Tim Wickberg <tim@schedmd.com>
Origin: https://github.com/SchedMD/slurm/commit/b30e9e9ee2ade6951bfaf28e15ef77325a206971
Bug-Debian: https://bugs.debian.org/880530
Last-Update: 2017-11-02

--- slurm-llnl-16.05.9.orig/src/slurmd/slurmd/req.c
+++ slurm-llnl-16.05.9/src/slurmd/slurmd/req.c
@@ -5580,10 +5580,8 @@ _build_env(job_env_t *job_env)
 		job_env->spank_job_env_size = 0;
 		job_env->spank_job_env = (char **) NULL;
 	}
-	if (job_env->spank_job_env_size) {
-		env_array_merge_spank(&env,
-				      (const char **) job_env->spank_job_env);
-	}
+	if (job_env->spank_job_env_size)
+		env_array_merge(&env, (const char **) job_env->spank_job_env);
 
 	slurm_mutex_lock(&conf->config_mutex);
 	setenvf(&env, "SLURMD_NODENAME", "%s", conf->node_name);
